# 字典存储与安全配置实施方案

本方案基于您提供的设计，实现了通用的字典存储，并明确了安全数据的处理策略。

## 1. 数据库实体设计 (libs/db)

我们将创建一个通用的字典表 `SysDict`，利用 JSON 列存储非敏感的元数据。

### Entity: `sys_dict`

-   **文件**: `backend/libs/db/src/entities/dict.entity.ts`
-   **功能**: 存储通用的字典数据，支持分组、排序、状态和 JSON 元数据。
-   **字段定义**:
    -   `group`: string (分组编码，如 `payment_method`)
    -   `label`: string (展示名，如 `微信支付`)
    -   `value`: string (业务值，如 `wechat`)
    -   `meta`: json (扩展配置，如图标、货币类型、UI颜色)
    -   `sort`: int (排序)
    -   `status`: int (1:启用, 0:禁用)
    -   `isDefault`: boolean (是否默认)
    -   `remark`: string (备注)

## 2. 模块实现 (cms-admin-api)

在后台管理 API 中实现字典的管理功能。

### 模块结构

-   `src/dictionary/dictionary.module.ts`: 注册模块与实体。
-   `src/dictionary/dictionary.controller.ts`: 提供管理接口。
-   `src/dictionary/dictionary.service.ts`: 业务逻辑。
-   `src/dictionary/dto/create-dict.dto.ts`: 数据传输对象。

### 核心功能

1.  **CRUD**: 增删改查字典项。
2.  **Get By Group**: 前端核心接口，通过 `group` 获取该组所有启用的选项（包含 meta）。

## 3. 安全与配置策略 (确认)

针对您提到的支付密钥安全问题，本方案严格遵循 **配置与密钥分离** 的原则：

-   **非敏感数据 (`sys_dict`)**: 仅存储前端展示或非加密逻辑所需的配置。
    -   例如：`icon_url`, `gateway_url`, `currency_support`。
    -   这些数据可以通过 API 直接下发给前端。
-   **敏感凭证 (Secrets)**: **严禁** 存入字典表。
    -   支付商密钥 (`SecretKey`, `PrivateKey`) 应存储在环境变量 (`.env`) 或加密的配置表 (`sys_config`) 中。
    -   后端 Service 根据字典的 `value` (如 `wechat`) 选择对应的策略类，策略类内部读取安全的密钥配置进行调用。

## 4. 实施步骤

1.  **创建实体**: 新建 `DictEntity` 并导出。
2.  **更新配置**: 将 `DictEntity` 添加到 `cms-admin-api` 的数据库配置 (`database.config.ts`) 中。
3.  **生成模块**: 创建 `Dictionary` 相关的 Module, Service, Controller 和 DTO。
4.  **注册模块**: 在 `AppModule` 中引入 `DictionaryModule`。
